version: '3.8'

services:
  researcharr:
    image: ghcr.io/wikid82/researcharr:latest
    container_name: researcharr
    restart: unless-stopped
    ports:
      - "2929:2929" # Expose web UI on port 2929
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/New_York
      - WEBUI_PORT=2929
      - LOGLEVEL=INFO
    volumes:
      # Persist runtime configuration and DB to host for inspection/troubleshooting
      - ./config:/config:rw
      # Persist logs written under /config/logs (cron, scheduler, etc.)
      - ./logs:/config/logs:rw
    logging:
      driver: json-file
      options:
        max-size: "50m"
        max-file: "5"
    healthcheck:
      test: ["CMD-SHELL", "curl -fsS http://localhost:2929/health || exit 1"]
      version: '3.8'

      services:
        researcharr:
          image: ghcr.io/wikid82/researcharr:latest
          container_name: researcharr
          restart: unless-stopped
          ports:
            - "2929:2929" # Expose web UI on port 2929
          environment:
            - PUID=1000
            - PGID=1000
            - TZ=America/New_York
            - PYTHONUNBUFFERED=1
            - WEBUI_PORT=2929
            - LOGLEVEL=INFO
          volumes:
            # Persist runtime configuration and DB to host for inspection/troubleshooting
            - ./config:/config:rw
            # Persist logs written under /config/logs (cron, scheduler, etc.)
            - ./logs:/config/logs:rw
          depends_on:
            - radarr
            - sonarr
          logging:
            driver: json-file
            options:
              max-size: "50m"
              max-file: "5"
          healthcheck:
            test: ["CMD-SHELL", "curl -fsS http://localhost:2929/health || exit 1"]
            interval: 30s
            timeout: 5s
            retries: 3
          deploy:
            resources:
              limits:
                cpus: '1.0'
                memory: 2G
              reservations:
                cpus: '0.5'
                memory: 512M
