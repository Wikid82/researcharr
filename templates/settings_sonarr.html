{% extends 'base.html' %}
{% block title %}Sonarr Settings{% endblock %}
{% block content %}
<form method="post" action="/settings/sonarr">
  <fieldset><legend>Sonarr Instances</legend>
    {% for i in range(5) %}
      <fieldset style="margin:10px; border:1px solid #ccc;">
        <legend>Sonarr {{i+1}}</legend>
        {% if sonarr|length > i %}
        Enable: <label class="switch"><input name="sonarr{{i}}_enabled" type="checkbox" {% if sonarr[i]['enabled'] %}checked{% endif %} onchange="toggleInstance('sonarr', {{i}})"><span class="slider round"></span></label><br>
        <div id="sonarr_fields_{{i}}" class="instance-fields{% if sonarr[i]['enabled'] %} open{% endif %}">
          Name: <input name="sonarr{{i}}_name" value="{{ sonarr[i]['name'] }}"><br>
          URL: <input name="sonarr{{i}}_url" value="{{ sonarr[i]['url'] }}"><br>
          API Key: <input name="sonarr{{i}}_api_key" value="{{ sonarr[i]['api_key'] }}"><br>
          Process: <input name="sonarr{{i}}_process" type="checkbox" {% if sonarr[i].get('process', False) %}checked{% endif %}><br>
          Process by: <select name="sonarr{{i}}_mode">
            <option value="series" {% if sonarr[i].get('mode', 'series') == 'series' %}selected{% endif %}>Series (default, most efficient)</option>
            <option value="season" {% if sonarr[i].get('mode') == 'season' %}selected{% endif %}>Season</option>
            <option value="episode" {% if sonarr[i].get('mode') == 'episode' %}selected{% endif %}>Episode</option>
          </select><br>
          API Pulls per Hour: <input name="sonarr{{i}}_api_pulls" value="{{ sonarr[i].get('api_pulls', 20) }}" style="width:60px;"> <small>(default: 20)</small><br>
          Enable State Management: <input name="sonarr{{i}}_state_mgmt" type="checkbox" {% if sonarr[i].get('state_mgmt', True) %}checked{% endif %}><br>
          Episodes to Upgrade: <input name="sonarr{{i}}_episodes_to_upgrade" value="{{ sonarr[i].get('episodes_to_upgrade', '') }}"><br>
          Max Download Queue: <input name="sonarr{{i}}_max_download_queue" value="{{ sonarr[i].get('max_download_queue', 15) }}"><br>
          Reprocess Interval (days): <input name="sonarr{{i}}_reprocess_interval_days" value="{{ sonarr[i].get('reprocess_interval_days', 7) }}"><br>
          <button type="button" onclick="testConnection('sonarr', {{i}})">Test Connection</button>
          <button type="button" onclick="validateSonarr({{i}})">Validate & Save</button>
          <span id="sonarr_status_{{i}}" class="test-result"></span>
          <span id="sonarr_validate_{{i}}" class="validate-result"></span>
        </div>
        {% else %}
        Enable: <label class="switch"><input name="sonarr{{i}}_enabled" type="checkbox" onchange="toggleInstance('sonarr', {{i}})"><span class="slider round"></span></label><br>
        <div id="sonarr_fields_{{i}}" class="instance-fields">
          Name: <input name="sonarr{{i}}_name"><br>
          URL: <input name="sonarr{{i}}_url"><br>
          API Key: <input name="sonarr{{i}}_api_key"><br>
          Process: <input name="sonarr{{i}}_process" type="checkbox"><br>
          Process by: <select name="sonarr{{i}}_mode">
            <option value="series" selected>Series (default, most efficient)</option>
            <option value="season">Season</option>
            <option value="episode">Episode</option>
          </select><br>
          API Pulls per Hour: <input name="sonarr{{i}}_api_pulls" value="20" style="width:60px;"> <small>(default: 20)</small><br>
          Enable State Management: <input name="sonarr{{i}}_state_mgmt" type="checkbox" checked><br>
          Episodes to Upgrade: <input name="sonarr{{i}}_episodes_to_upgrade"><br>
          Max Download Queue: <input name="sonarr{{i}}_max_download_queue" value="15"><br>
          Reprocess Interval (days): <input name="sonarr{{i}}_reprocess_interval_days" value="7"><br>
          <button type="button" onclick="testConnection('sonarr', {{i}})">Test Connection</button>
          <button type="button" onclick="validateSonarr({{i}})">Validate & Save</button>
          <span id="sonarr_status_{{i}}" class="test-result"></span>
          <span id="sonarr_validate_{{i}}" class="validate-result"></span>
        </div>
        {% endif %}
      </fieldset>
    {% endfor %}
  </fieldset>
  <br><input type="submit" value="Save Sonarr Settings">
</form>
{% endblock %}
