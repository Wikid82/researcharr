<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="researcharr contributors" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Backup and Recovery Procedures - researcharr</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/css/researcharr.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Backup and Recovery Procedures";
        var mkdocs_page_input_path = "Backup-and-Recovery.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> researcharr
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">researcharr documentation â€” Day One</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../API/">ResearchArr API (v1)</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Backup and Recovery Procedures</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#backup-strategy">Backup Strategy</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#what-gets-backed-up">What Gets Backed Up</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#backup-types">Backup Types</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#retention-policy">Retention Policy</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#creating-backups">Creating Backups</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#automatic-backups">Automatic Backups</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#manual-backups">Manual Backups</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#via-cli">Via CLI</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#via-api">Via API</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#pre-upgrade-backups">Pre-Upgrade Backups</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#restoring-backups">Restoring Backups</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#restore-process">Restore Process</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#via-cli_1">Via CLI</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#via-api_1">Via API</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#restore-results">Restore Results</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#monitoring-and-alerts">Monitoring and Alerts</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#backup-health-monitoring">Backup Health Monitoring</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#metrics">Metrics</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#alerting">Alerting</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#event-bus-integration">Event Bus Integration</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#validation-and-integrity">Validation and Integrity</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#validate-backups">Validate Backups</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#integrity-checks">Integrity Checks</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#best-practices">Best Practices</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#backup-frequency">Backup Frequency</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#backup-location">Backup Location</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#testing-restores">Testing Restores</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#retention-strategy">Retention Strategy</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#compression-levels">Compression Levels</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#documentation">Documentation</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#backup-creation-fails">Backup Creation Fails</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#restore-fails">Restore Fails</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#rollback-executed">Rollback Executed</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#stale-backups-alert">Stale Backups Alert</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#see-also">See Also</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CI-and-Development/">CI and Development</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CLI-Usage/">CLI Usage Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CONFIGURATION/">Configuration Reference</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Changelog/">Changelog</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Contributing/">Contributing to researcharr</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Coverage-CI-Local-Differences/">Coverage Differences: CI vs Local</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Coverage-Gutters-Example-Comparison/">Coverage Gutters Example Structure</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Coverage-Gutters-Quick-Reference/">Coverage Gutters - Quick Reference Card</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Coverage-Gutters-Quick-Start/">Coverage Gutters - Visual Quick Start Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Coverage-Gutters-Setup/">Coverage Gutters Setup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../DEV/">DEV</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Deployment-and-Resources/">Deployment and Resource Recommendations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Environment-Variables/">Environment variables</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../FAQ/">FAQ</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Getting-Started/">Getting Started</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Health-and-Metrics/">Health and Metrics Endpoints</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Integrations/">Integrations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Logs/">Logs and Live Streaming</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Packaging-and-Distribution/">Packaging and Distribution</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Plugins/">Plugins and instance configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Recent-Changes/">Recent Changes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Renovate-Configuration/">Renovate Bot Configuration Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Roadmap/">Roadmap</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../SERVICES_ARCHITECTURE/">Services Architecture</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Status-and-Warnings/">System status warnings and how to fix them</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Versioning/">Versioning &amp; Releases</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../WHEELHOUSE/">Wheelhouse (built wheels) workflow</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../tooling-experiments/">Experimental Tooling: Sourcery &amp; Vulture</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">researcharr</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Backup and Recovery Procedures</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="backup-and-recovery-procedures">Backup and Recovery Procedures</h1>
<p>This guide provides comprehensive backup and recovery procedures for ResearchArr operators. It covers backup strategies, recovery procedures, automated scheduling, and best practices.</p>
<h2 id="overview">Overview</h2>
<p>ResearchArr includes built-in backup and recovery capabilities:</p>
<ul>
<li><strong>Automated backups</strong> - Scheduled backups via configuration</li>
<li><strong>Manual backups</strong> - CLI and API for on-demand backups</li>
<li><strong>Safe restores</strong> - Automatic rollback on failure</li>
<li><strong>Retention policies</strong> - Configurable backup pruning</li>
<li><strong>Monitoring</strong> - Backup health metrics and alerts</li>
<li><strong>Validation</strong> - Integrity checking before restore</li>
</ul>
<h2 id="backup-strategy">Backup Strategy</h2>
<h3 id="what-gets-backed-up">What Gets Backed Up</h3>
<p>Backups include:
- <strong>Database</strong> - <code>researcharr.db</code> (application data)
- <strong>Configuration</strong> - <code>config.yml</code> and related files
- <strong>Metadata</strong> - Backup timestamp, compression info</p>
<p>Backups do <strong>not</strong> include:
- Application code
- Docker images
- Logs (backed up separately)
- Temporary files</p>
<h3 id="backup-types">Backup Types</h3>
<p><strong>Full Backups</strong>
- Complete database and configuration snapshot
- Compressed with configurable compression level
- Self-contained and portable</p>
<p><strong>Pre-Restore Snapshots</strong>
- Automatic snapshot before restore operations
- Enables rollback if restore fails
- Temporary, cleaned up after successful restore</p>
<h3 id="retention-policy">Retention Policy</h3>
<p>Configure retention in <code>config.yml</code>:</p>
<pre><code class="language-yaml">backup:
  retention_count: 7        # Keep last 7 backups
  auto_backup_enabled: true # Enable automatic backups
  backup_schedule_cron: &quot;0 2 * * *&quot;  # Daily at 2 AM
</code></pre>
<p>Retention strategies:
- <strong>Daily</strong>: 7-14 days of backups
- <strong>Weekly</strong>: 4-8 weeks of backups
- <strong>Monthly</strong>: 6-12 months of backups</p>
<p>Use multiple strategies:</p>
<pre><code class="language-bash"># Keep 7 daily backups
0 2 * * * researcharr-cli backup create &amp;&amp; researcharr-cli backup prune --keep 7

# Keep 4 weekly backups (Sunday)
0 3 * * 0 researcharr-cli backup create &amp;&amp; researcharr-cli backup prune --keep 4
</code></pre>
<h2 id="creating-backups">Creating Backups</h2>
<h3 id="automatic-backups">Automatic Backups</h3>
<p>Enable in configuration:</p>
<pre><code class="language-yaml">backup:
  auto_backup_enabled: true
  backup_schedule_cron: &quot;0 2 * * *&quot;  # Daily at 2 AM
  compression_level: 6
  retention_count: 7
</code></pre>
<p>The scheduler will:
1. Create backup at scheduled time
2. Validate backup integrity
3. Prune old backups per retention policy
4. Publish metrics and alerts</p>
<h3 id="manual-backups">Manual Backups</h3>
<h4 id="via-cli">Via CLI</h4>
<pre><code class="language-bash"># Create backup with default compression
researcharr-cli backup create

# Create backup with maximum compression
researcharr-cli backup create --compression 9

# List backups
researcharr-cli backup list
</code></pre>
<h4 id="via-api">Via API</h4>
<pre><code class="language-bash"># Create backup
curl -X POST http://localhost:2929/api/backups

# List backups
curl http://localhost:2929/api/backups

# Get backup info
curl http://localhost:2929/api/backups/backup_20250110_120000.tar.gz
</code></pre>
<h3 id="pre-upgrade-backups">Pre-Upgrade Backups</h3>
<p>Always create a backup before upgrading:</p>
<pre><code class="language-bash">#!/bin/bash
set -e

# Create pre-upgrade backup
echo &quot;Creating pre-upgrade backup...&quot;
researcharr-cli backup create

# Verify backup
LATEST=$(researcharr-cli backup list --json | jq -r '.[0].filename')
researcharr-cli backup validate &quot;$LATEST&quot;

# Proceed with upgrade
echo &quot;Backup verified. Proceeding with upgrade...&quot;
</code></pre>
<h2 id="restoring-backups">Restoring Backups</h2>
<h3 id="restore-process">Restore Process</h3>
<p>The restore operation follows these steps:</p>
<ol>
<li><strong>Pre-Restore Snapshot</strong> - Create snapshot of current state</li>
<li><strong>Validation</strong> - Verify backup integrity</li>
<li><strong>Schema Check</strong> - Ensure backup is compatible</li>
<li><strong>Restore</strong> - Apply backup to database and config</li>
<li><strong>Integrity Check</strong> - Verify restored data</li>
<li><strong>Rollback</strong> - Automatic rollback if checks fail</li>
</ol>
<h3 id="via-cli_1">Via CLI</h3>
<pre><code class="language-bash"># List available backups
researcharr-cli backup list

# Restore from specific backup
researcharr-cli backup restore backup_20250110_120000.tar.gz

# Force restore without confirmation
researcharr-cli backup restore backup_20250110_120000.tar.gz --force

# Restore without automatic rollback (not recommended)
researcharr-cli backup restore backup_20250110_120000.tar.gz --no-rollback
</code></pre>
<h3 id="via-api_1">Via API</h3>
<pre><code class="language-bash"># Restore from backup
curl -X POST http://localhost:2929/api/backups/backup_20250110_120000.tar.gz/restore
</code></pre>
<h3 id="restore-results">Restore Results</h3>
<p>The restore operation returns detailed results:</p>
<pre><code class="language-json">{
  &quot;success&quot;: true,
  &quot;message&quot;: &quot;Backup restored successfully&quot;,
  &quot;backup_file&quot;: &quot;backup_20250110_120000.tar.gz&quot;,
  &quot;pre_restore_snapshot&quot;: &quot;pre_restore_20250110_130000.tar.gz&quot;,
  &quot;restored_at&quot;: &quot;2025-01-10T13:00:00Z&quot;,
  &quot;rollback_executed&quot;: false,
  &quot;integrity_passed&quot;: true
}
</code></pre>
<p>If restore fails:</p>
<pre><code class="language-json">{
  &quot;success&quot;: false,
  &quot;message&quot;: &quot;Integrity check failed after restore, rolled back to snapshot&quot;,
  &quot;backup_file&quot;: &quot;backup_20250110_120000.tar.gz&quot;,
  &quot;pre_restore_snapshot&quot;: &quot;pre_restore_20250110_130000.tar.gz&quot;,
  &quot;rollback_executed&quot;: true,
  &quot;error&quot;: &quot;Database integrity check failed&quot;
}
</code></pre>
<h2 id="monitoring-and-alerts">Monitoring and Alerts</h2>
<h3 id="backup-health-monitoring">Backup Health Monitoring</h3>
<p>The backup monitor tracks:
- <strong>Last backup timestamp</strong> - Time of most recent backup
- <strong>Backup count</strong> - Total number of backups
- <strong>Failed backups</strong> - Count of failed backup attempts
- <strong>Stale backups</strong> - Warning if backups are too old</p>
<h3 id="metrics">Metrics</h3>
<p>View metrics at <code>/metrics</code> endpoint:</p>
<pre><code># HELP backup_count Total number of backups
# TYPE backup_count gauge
backup_count 7

# HELP backup_last_timestamp Timestamp of last successful backup
# TYPE backup_last_timestamp gauge
backup_last_timestamp 1736510400

# HELP backup_failed_count Number of failed backup attempts
# TYPE backup_failed_count counter
backup_failed_count 0

# HELP backup_stale Indicates if backups are stale (1) or current (0)
# TYPE backup_stale gauge
backup_stale 0
</code></pre>
<h3 id="alerting">Alerting</h3>
<p>Configure alerting in monitoring system:</p>
<p><strong>Prometheus Alert Rules</strong>:</p>
<pre><code class="language-yaml">groups:
  - name: backup_alerts
    rules:
      - alert: BackupStale
        expr: backup_stale == 1
        for: 1h
        annotations:
          summary: &quot;ResearchArr backups are stale&quot;
          description: &quot;No backup created in configured threshold&quot;

      - alert: BackupFailed
        expr: increase(backup_failed_count[1h]) &gt; 0
        annotations:
          summary: &quot;ResearchArr backup failed&quot;
          description: &quot;Backup operation failed {{ $value }} times in last hour&quot;

      - alert: NoRecentBackup
        expr: time() - backup_last_timestamp &gt; 86400 * 2
        annotations:
          summary: &quot;No ResearchArr backup in 2 days&quot;
          description: &quot;Last backup was {{ $value | humanizeDuration }} ago&quot;
</code></pre>
<h3 id="event-bus-integration">Event Bus Integration</h3>
<p>Backup events are published to the event bus:</p>
<ul>
<li><code>BACKUP_CREATED</code> - Backup successfully created</li>
<li><code>BACKUP_FAILED</code> - Backup creation failed</li>
<li><code>BACKUP_RESTORED</code> - Backup successfully restored</li>
<li><code>BACKUP_RESTORE_FAILED</code> - Restore operation failed</li>
<li><code>BACKUP_PRUNED</code> - Old backups pruned</li>
<li><code>BACKUP_STALE</code> - Backups are stale</li>
<li><code>BACKUP_VALIDATION_FAILED</code> - Backup validation failed</li>
<li><code>PRE_RESTORE_SNAPSHOT_CREATED</code> - Pre-restore snapshot created</li>
<li><code>RESTORE_ROLLBACK_EXECUTED</code> - Restore rollback executed</li>
</ul>
<p>Subscribe to events for custom alerting:</p>
<pre><code class="language-python">from researcharr.core.events import get_event_bus

def on_backup_failed(event_data):
    # Send alert
    send_alert(&quot;Backup failed&quot;, event_data)

event_bus = get_event_bus()
event_bus.subscribe(&quot;BACKUP_FAILED&quot;, on_backup_failed)
</code></pre>
<h2 id="validation-and-integrity">Validation and Integrity</h2>
<h3 id="validate-backups">Validate Backups</h3>
<p>Verify backup integrity without restoring:</p>
<pre><code class="language-bash"># Validate specific backup
researcharr-cli backup validate backup_20250110_120000.tar.gz

# Validate all backups
researcharr-cli backup list --json | \
  jq -r '.[].filename' | \
  xargs -I {} researcharr-cli backup validate {}
</code></pre>
<h3 id="integrity-checks">Integrity Checks</h3>
<p>Backups are validated for:
- <strong>Archive integrity</strong> - Valid tar.gz format
- <strong>Required files</strong> - Database and config present
- <strong>Metadata</strong> - Backup metadata is valid
- <strong>Schema version</strong> - Compatible schema version</p>
<p>Before restore:
- Backup integrity validated
- Schema compatibility checked
- Pre-restore snapshot created</p>
<p>After restore:
- Database integrity verified
- Configuration validated
- Automatic rollback if checks fail</p>
<h2 id="best-practices">Best Practices</h2>
<h3 id="backup-frequency">Backup Frequency</h3>
<p><strong>Production Systems</strong>:
- Daily automated backups
- Pre-upgrade manual backups
- Before major configuration changes</p>
<p><strong>Development Systems</strong>:
- Weekly automated backups
- Before testing major changes</p>
<h3 id="backup-location">Backup Location</h3>
<p><strong>Local Backups</strong>:</p>
<pre><code class="language-yaml">backup:
  backup_dir: /config/backups
</code></pre>
<p><strong>Remote Backups</strong> (recommended):</p>
<pre><code class="language-bash"># Sync to remote storage after backup
0 3 * * * researcharr-cli backup create &amp;&amp; \
  rsync -avz /config/backups/ backup-server:/backups/researcharr/
</code></pre>
<p><strong>Cloud Storage</strong>:</p>
<pre><code class="language-bash"># Upload to S3
0 3 * * * researcharr-cli backup create &amp;&amp; \
  aws s3 sync /config/backups/ s3://my-bucket/researcharr-backups/
</code></pre>
<h3 id="testing-restores">Testing Restores</h3>
<p><strong>Regular restore testing</strong> is critical:</p>
<pre><code class="language-bash">#!/bin/bash
# Monthly restore test

# Create test backup
TEST_BACKUP=$(researcharr-cli backup create | grep &quot;Created backup&quot; | awk '{print $3}')

# Validate backup
researcharr-cli backup validate &quot;$TEST_BACKUP&quot;

# In test environment, restore backup
researcharr-cli backup restore &quot;$TEST_BACKUP&quot; --force

# Verify application health
researcharr-cli health

# Log results
echo &quot;Restore test successful: $TEST_BACKUP&quot; | \
  mail -s &quot;ResearchArr Restore Test&quot; admin@example.com
</code></pre>
<h3 id="retention-strategy">Retention Strategy</h3>
<p><strong>3-2-1 Backup Rule</strong>:
- <strong>3</strong> copies of data
- <strong>2</strong> different storage types
- <strong>1</strong> off-site copy</p>
<p>Example:</p>
<pre><code class="language-bash">#!/bin/bash
# Daily backup with 3-2-1 strategy

# Create local backup
researcharr-cli backup create

# Copy to NAS (2nd storage)
rsync -avz /config/backups/ /mnt/nas/researcharr/

# Copy to cloud (off-site)
aws s3 sync /config/backups/ s3://my-bucket/researcharr/

# Prune old backups locally
researcharr-cli backup prune --keep 7

# Prune old backups on NAS
find /mnt/nas/researcharr/ -name &quot;backup_*.tar.gz&quot; -mtime +30 -delete

# Keep cloud backups for 90 days
aws s3 ls s3://my-bucket/researcharr/ | \
  awk '{print $4}' | \
  while read file; do
    age=$((($(date +%s) - $(date -d &quot;$(echo $file | cut -d_ -f2 | cut -d. -f1)&quot; +%s))/86400))
    if [ $age -gt 90 ]; then
      aws s3 rm &quot;s3://my-bucket/researcharr/$file&quot;
    fi
  done
</code></pre>
<h3 id="compression-levels">Compression Levels</h3>
<p>Balance compression vs. speed:</p>
<ul>
<li><strong>Level 0</strong> - No compression, fastest</li>
<li><strong>Level 6</strong> - Default, good balance</li>
<li><strong>Level 9</strong> - Maximum compression, slowest</li>
</ul>
<p>Example:</p>
<pre><code class="language-yaml">backup:
  compression_level: 6  # Balanced
</code></pre>
<p>For large databases:</p>
<pre><code class="language-yaml">backup:
  compression_level: 3  # Faster backups
</code></pre>
<p>For archival:</p>
<pre><code class="language-bash"># Maximum compression for long-term storage
researcharr-cli backup create --compression 9
</code></pre>
<h3 id="documentation">Documentation</h3>
<p>Document your backup procedures:</p>
<ul>
<li>Backup schedule and retention</li>
<li>Restore procedures</li>
<li>Contact information</li>
<li>Storage locations</li>
<li>Testing schedule</li>
</ul>
<p>Example runbook:</p>
<pre><code class="language-markdown"># ResearchArr Backup Procedures

## Schedule
- Daily: 2 AM UTC (automated)
- Pre-upgrade: Manual
- Pre-change: Manual

## Retention
- Local: 7 days
- NAS: 30 days
- S3: 90 days

## Restore Procedure
1. Stop application
2. List backups: `researcharr-cli backup list`
3. Restore: `researcharr-cli backup restore &lt;file&gt;`
4. Verify: `researcharr-cli health`
5. Start application

## Contacts
- Primary: ops@example.com
- Secondary: admin@example.com

## Storage
- Local: /config/backups
- NAS: /mnt/nas/researcharr
- S3: s3://my-bucket/researcharr
</code></pre>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="backup-creation-fails">Backup Creation Fails</h3>
<p><strong>Check disk space</strong>:</p>
<pre><code class="language-bash">df -h /config/backups
</code></pre>
<p><strong>Check permissions</strong>:</p>
<pre><code class="language-bash">ls -la /config/backups
</code></pre>
<p><strong>Check logs</strong>:</p>
<pre><code class="language-bash">tail -f /config/logs/researcharr.log
</code></pre>
<h3 id="restore-fails">Restore Fails</h3>
<p><strong>Validate backup first</strong>:</p>
<pre><code class="language-bash">researcharr-cli backup validate backup_20250110_120000.tar.gz
</code></pre>
<p><strong>Check schema compatibility</strong>:</p>
<pre><code class="language-bash">researcharr-cli backup info backup_20250110_120000.tar.gz | grep schema
</code></pre>
<p><strong>Force restore</strong> (if validation passes):</p>
<pre><code class="language-bash">researcharr-cli backup restore backup_20250110_120000.tar.gz --force
</code></pre>
<h3 id="rollback-executed">Rollback Executed</h3>
<p>If automatic rollback occurs:</p>
<ol>
<li>Check logs for failure reason</li>
<li>Validate backup integrity</li>
<li>Check schema compatibility</li>
<li>Retry with validated backup</li>
</ol>
<h3 id="stale-backups-alert">Stale Backups Alert</h3>
<p>If backups are stale:</p>
<ol>
<li>Check if backup schedule is running</li>
<li>Verify scheduler service is active</li>
<li>Check for disk space issues</li>
<li>Review backup logs for errors</li>
</ol>
<h2 id="see-also">See Also</h2>
<ul>
<li><a href="../CLI-Usage/">CLI Usage Guide</a> - CLI command reference</li>
<li><a href="Disaster-Recovery.md">Disaster Recovery Guide</a> - Disaster recovery procedures</li>
<li><a href="../Health-and-Metrics/">Health and Metrics</a> - Monitoring and metrics</li>
<li><a href="../Deployment-and-Resources/">Deployment Guide</a> - Deployment best practices</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../API/" class="btn btn-neutral float-left" title="ResearchArr API (v1)"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../CI-and-Development/" class="btn btn-neutral float-right" title="CI and Development">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="None" class="fa fa-code-fork" style="color: #fcfcfc"> Wikid82/researcharr</a>
        </span>
    
    
      <span><a href="../API/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../CI-and-Development/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
