<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="researcharr contributors" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Versioning & Releases - researcharr</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/css/researcharr.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Versioning \u0026 Releases";
        var mkdocs_page_input_path = "Versioning.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> researcharr
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">researcharr documentation — Day One</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../API/">ResearchArr API (v1)</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Backup-and-Recovery/">Backup and Recovery Procedures</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CI-and-Development/">CI and Development</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CLI-Usage/">CLI Usage Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CONFIGURATION/">Configuration Reference</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Changelog/">Changelog</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Contributing/">Contributing to researcharr</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Coverage-CI-Local-Differences/">Coverage Differences: CI vs Local</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Coverage-Gutters-Example-Comparison/">Coverage Gutters Example Structure</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Coverage-Gutters-Quick-Reference/">Coverage Gutters - Quick Reference Card</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Coverage-Gutters-Quick-Start/">Coverage Gutters - Visual Quick Start Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Coverage-Gutters-Setup/">Coverage Gutters Setup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../DEV/">DEV</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Deployment-and-Resources/">Deployment and Resource Recommendations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Environment-Variables/">Environment variables</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../FAQ/">FAQ</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Getting-Started/">Getting Started</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Health-and-Metrics/">Health and Metrics Endpoints</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Integrations/">Integrations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Logs/">Logs and Live Streaming</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Packaging-and-Distribution/">Packaging and Distribution</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Plugins/">Plugins and instance configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Recent-Changes/">Recent Changes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Renovate-Configuration/">Renovate Bot Configuration Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Roadmap/">Roadmap</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../SERVICES_ARCHITECTURE/">Services Architecture</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Status-and-Warnings/">System status warnings and how to fix them</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Versioning & Releases</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#what-we-publish">What we publish</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#ci-build-tagging-example">CI build &amp; tagging (example)</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#runtime-how-to-identify-the-running-image">Runtime: how to identify the running image</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#injecting-digest-at-runtime-optional">Injecting digest at runtime (optional)</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#troubleshooting-checklist-for-support">Troubleshooting checklist for support</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#advanced-inspecting-image-manifests">Advanced: inspecting image manifests</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#versioning-policy-notes">Versioning policy notes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#pre-release-policy-for-non-tag-builds">Pre-release policy for non-tag builds</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../WHEELHOUSE/">Wheelhouse (built wheels) workflow</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../tooling-experiments/">Experimental Tooling: Sourcery & Vulture</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">researcharr</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">Versioning & Releases</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="versioning-releases">Versioning &amp; Releases</h1>
<p>This document provides detailed guidance for build metadata, CI tagging,
deployment best practices, and troubleshooting. The README contains a short
summary and example usage; this page contains the full reference for
maintainers and operators.</p>
<h2 id="what-we-publish">What we publish</h2>
<ul>
<li>Tags: CI publishes multiple tags for each successful build:</li>
<li>Semantic tag derived from <code>git describe --tags</code> when available (e.g. <code>1.2.3</code>).</li>
<li>Build-specific tag: <code>${VERSION}-build${BUILD_NUMBER}</code> (e.g. <code>1.2.3-build45</code>).</li>
<li>Short SHA tag: the first 8 chars of commit SHA (e.g. <code>abcdef12</code>).</li>
<li>
<p>Branch tags: the branch name and a <code>branch-&lt;name&gt;</code> tag for easier QA.</p>
</li>
<li>
<p>OCI labels: images include these labels (set at build time):</p>
</li>
<li><code>org.opencontainers.image.version</code> — the release/version string</li>
<li><code>org.opencontainers.image.revision</code> — short git sha</li>
<li>
<p><code>org.opencontainers.image.created</code> — UTC build datetime</p>
</li>
<li>
<p><code>/app/VERSION</code> file: the image includes a small file created at build
  time with key=value lines, for example:</p>
</li>
</ul>
<pre><code>version=1.2.3
build=45
sha=abcdef12
</code></pre>
<p>The running application exposes the same values via <code>/api/version</code>.</p>
<h2 id="ci-build-tagging-example">CI build &amp; tagging (example)</h2>
<p>In GitHub Actions, set these environment values before the Docker build:</p>
<pre><code class="language-bash"># CI versioning policy (pre-release behavior):
# - If the current commit has an exact tag, CI will use that tag as the
#   canonical semantic version (a leading 'v' is stripped, e.g. v1.2.3 -&gt; 1.2.3).
# - If there is no exact tag but a nearby descriptive tag exists and looks
#   like semver, CI will prefer that derived value.
# - Otherwise CI will emit a reproducible pre-release version so non-tag
#   builds are traceable. The default format is `0.0.0-alpha.&lt;GITHUB_RUN_NUMBER&gt;`.

# Example POSIX-friendly derivation used in our workflow (simplified):
RAW_TAG=$(git describe --tags --exact-match 2&gt;/dev/null || true)
if [ -n &quot;$RAW_TAG&quot; ]; then
  VERSION=${RAW_TAG#v}
else
  DESC=$(git describe --tags --dirty --always 2&gt;/dev/null || true)
  if printf '%s' &quot;$DESC&quot; | grep -Eq '^[v]?[0-9]+\.[0-9]+\.[0-9]'; then
    VERSION=${DESC#v}
  else
    VERSION=&quot;0.0.0-alpha.${GITHUB_RUN_NUMBER}&quot;
  fi
fi

BUILD_NUMBER=${GITHUB_RUN_NUMBER}
GIT_SHA=${GITHUB_SHA::8}
BUILD_DATE=$(date -u +%Y-%m-%dT%H:%M:%SZ)
</code></pre>
<p>Then pass them to the Docker build as build args and tag multiple images. The
CI workflow should also capture and print the pushed image digest so support
can later correlate a running container with the pushed image.</p>
<h2 id="runtime-how-to-identify-the-running-image">Runtime: how to identify the running image</h2>
<p>Support and automated systems should collect:</p>
<ul>
<li>The output of the <code>/api/version</code> endpoint (JSON). This returns the
  values from <code>/app/VERSION</code> and is intended to be public/read-only.</li>
<li>The container startup logs (the image metadata is logged on startup).</li>
<li>The registry digest (printed by CI). The digest uniquely identifies the
  pushed image and should be provided in CI logs; deployments can pin by
  digest (recommended) using <code>image@sha256:...</code>.</li>
</ul>
<h2 id="injecting-digest-at-runtime-optional">Injecting digest at runtime (optional)</h2>
<p>If you want the running container logs to include the exact pushed digest,
configure your deployment to set an environment variable (for example
<code>IMAGE_DIGEST</code>) when starting the container. The app will log <code>IMAGE_DIGEST</code>
if present in the environment.</p>
<p>Example <code>docker-compose</code> snippet:</p>
<pre><code class="language-yaml">services:
  researcharr:
    image: ghcr.io/wikid82/researcharr@sha256:&lt;digest&gt;
    environment:
      - IMAGE_DIGEST=sha256:&lt;digest&gt;
    volumes:
      - /path/to/config:/config
</code></pre>
<h2 id="troubleshooting-checklist-for-support">Troubleshooting checklist for support</h2>
<p>When a user reports an issue, ask for:</p>
<ol>
<li>Output of <code>GET /api/version</code>.</li>
<li>The first 50 lines of container logs (startup lines include Image build info).</li>
<li>The registry tag or digest used to deploy the image (if available).</li>
</ol>
<p>With these three pieces of data you can confirm whether the user's image
contains a fix or needs an update.</p>
<h2 id="advanced-inspecting-image-manifests">Advanced: inspecting image manifests</h2>
<p>Use <code>crane</code>, <code>skopeo</code>, or Docker registry API to inspect labels for a given
tag/digest. Example with <code>crane</code>:</p>
<pre><code class="language-bash">crane manifest ghcr.io/wikid82/researcharr:1.2.3 | jq '.'
</code></pre>
<p>This will show labels and the manifest digest.</p>
<h2 id="versioning-policy-notes">Versioning policy notes</h2>
<ul>
<li>Prefer semantic version tags for releases. Use build-specific tags for
  traceability between CI runs and pushed images.</li>
<li>Keep the README concise; this document contains the full guidance.</li>
</ul>
<h3 id="pre-release-policy-for-non-tag-builds">Pre-release policy for non-tag builds</h3>
<p>To make CI builds discoverable and sortable even when they are not produced
from a tagged release, the CI generates a small, predictable pre-release
version. The current policy is:</p>
<ul>
<li>If the workflow run is for a commit that has an exact tag, that tag (with a
  leading <code>v</code> stripped) becomes the canonical <code>VERSION</code> used for image labels
  and tags.</li>
<li>If no exact tag is present, CI will attempt to derive a semver-like string
  from <code>git describe</code>. If that fails, CI falls back to the pre-release form
  <code>0.0.0-alpha.&lt;GITHUB_RUN_NUMBER&gt;</code> where <code>&lt;GITHUB_RUN_NUMBER&gt;</code> is the numeric
  run id for the current workflow. This keeps non-tag builds unique and
  human-readable.</li>
</ul>
<p>Examples:</p>
<ul>
<li>Tagged release: commit has <code>v1.2.3</code> → image tag <code>1.2.3</code> and <code>1.2.3-build45</code>.</li>
<li>Non-tag build: no tag → image tag <code>0.0.0-alpha.45</code> and <code>0.0.0-alpha.45-build45</code>.</li>
</ul>
<p>These values are written into the image <code>/app/VERSION</code> file and exposed by
<code>GET /api/version</code> so both operators and automated systems can determine the
running build.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../Status-and-Warnings/" class="btn btn-neutral float-left" title="System status warnings and how to fix them"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../WHEELHOUSE/" class="btn btn-neutral float-right" title="Wheelhouse (built wheels) workflow">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../Status-and-Warnings/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../WHEELHOUSE/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
