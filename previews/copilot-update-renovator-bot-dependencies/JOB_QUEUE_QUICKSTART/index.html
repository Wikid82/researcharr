<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="researcharr contributors" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Job Queue System - Quick Start Guide - researcharr</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/css/researcharr.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Job Queue System - Quick Start Guide";
        var mkdocs_page_input_path = "JOB_QUEUE_QUICKSTART.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> researcharr
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">researcharr documentation â€” Day One</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../API/">ResearchArr API (v1)</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Backup-and-Recovery/">Backup and Recovery Procedures</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CI-and-Development/">CI and Development</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CLI-Usage/">CLI Usage Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CONFIGURATION/">Configuration Reference</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Changelog/">Changelog</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Contributing/">Contributing to researcharr</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Coverage-CI-Local-Differences/">Coverage Differences: CI vs Local</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Coverage-Gutters-Example-Comparison/">Coverage Gutters Example Structure</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Coverage-Gutters-Quick-Reference/">Coverage Gutters - Quick Reference Card</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Coverage-Gutters-Quick-Start/">Coverage Gutters - Visual Quick Start Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Coverage-Gutters-Setup/">Coverage Gutters Setup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../DEV/">DEV</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Deployment-and-Resources/">Deployment and Resource Recommendations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Environment-Variables/">Environment variables</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../FAQ/">FAQ</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Getting-Started/">Getting Started</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Health-and-Metrics/">Health and Metrics Endpoints</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Integrations/">Integrations</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Job Queue System - Quick Start Guide</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#basic-usage">Basic Usage</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#1-initialize-job-service">1. Initialize Job Service</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#2-register-job-handlers">2. Register Job Handlers</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#3-submit-jobs">3. Submit Jobs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#4-track-job-status">4. Track Job Status</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#advanced-features">Advanced Features</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#priority-levels">Priority Levels</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#retry-configuration">Retry Configuration</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#progress-tracking">Progress Tracking</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#dead-letter-queue">Dead Letter Queue</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#worker-management">Worker Management</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#metrics">Metrics</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#environment-variables">Environment Variables</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#programmatic-configuration">Programmatic Configuration</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#integration-with-existing-code">Integration with Existing Code</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#wrapping-existing-functions">Wrapping Existing Functions</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#integration-with-apscheduler">Integration with APScheduler</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#best-practices">Best Practices</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#jobs-not-processing">Jobs Not Processing</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#jobs-failing-repeatedly">Jobs Failing Repeatedly</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#redis-connection-issues">Redis Connection Issues</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#next-steps">Next Steps</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Logs/">Logs and Live Streaming</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Packaging-and-Distribution/">Packaging and Distribution</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Plugins/">Plugins and instance configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Recent-Changes/">Recent Changes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Renovate-Configuration/">Renovate Bot Configuration Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Roadmap/">Roadmap</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../SERVICES_ARCHITECTURE/">Services Architecture</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Status-and-Warnings/">System status warnings and how to fix them</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Versioning/">Versioning & Releases</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../WHEELHOUSE/">Wheelhouse (built wheels) workflow</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../tooling-experiments/">Experimental Tooling: Sourcery & Vulture</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Architecture</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../architecture/JOB_QUEUE_DESIGN/">Job Queue and Task Management - Architecture Design</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">researcharr</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">Job Queue System - Quick Start Guide</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="job-queue-system-quick-start-guide">Job Queue System - Quick Start Guide</h1>
<h2 id="overview">Overview</h2>
<p>The job queue system provides asynchronous task execution with:
- Redis-backed distributed queue
- Automatic retries with exponential backoff
- Priority-based execution
- Dead letter queue for failed jobs
- Real-time progress tracking
- Worker pool management</p>
<h2 id="installation">Installation</h2>
<pre><code class="language-bash"># Install Redis
pip install redis==5.0.10

# Or update requirements
pip install -r requirements.txt
</code></pre>
<h2 id="basic-usage">Basic Usage</h2>
<h3 id="1-initialize-job-service">1. Initialize Job Service</h3>
<pre><code class="language-python">from researcharr.core.jobs import JobService, JobPriority

# Create service (uses REDIS_URL env var or default)
job_service = JobService(redis_url=&quot;redis://localhost:6379/0&quot;)
await job_service.initialize()

# Start workers (default: CPU count)
await job_service.start_workers(count=4)
</code></pre>
<h3 id="2-register-job-handlers">2. Register Job Handlers</h3>
<pre><code class="language-python">from researcharr.core.jobs import JobDefinition

async def process_media(job: JobDefinition, progress_callback):
    &quot;&quot;&quot;Process media files.&quot;&quot;&quot;
    media_id = job.args[0]
    quality = job.kwargs.get(&quot;quality&quot;, &quot;medium&quot;)

    # Report progress
    await progress_callback(0, 100, &quot;Starting...&quot;)

    # Do work
    result = await do_processing(media_id, quality)

    # Report completion
    await progress_callback(100, 100, &quot;Complete&quot;)

    return result

# Register handler
job_service.register_handler(&quot;process_media&quot;, process_media)
</code></pre>
<h3 id="3-submit-jobs">3. Submit Jobs</h3>
<pre><code class="language-python"># Submit a job
job_id = await job_service.submit_job(
    &quot;process_media&quot;,
    args=(123,),
    kwargs={&quot;quality&quot;: &quot;high&quot;},
    priority=JobPriority.HIGH,
    timeout=300,  # 5 minutes
    max_retries=3,
)

print(f&quot;Job submitted: {job_id}&quot;)
</code></pre>
<h3 id="4-track-job-status">4. Track Job Status</h3>
<pre><code class="language-python"># Get status
status = await job_service.get_job_status(job_id)
print(f&quot;Status: {status}&quot;)  # PENDING, RUNNING, COMPLETED, etc.

# Wait for completion
while True:
    status = await job_service.get_job_status(job_id)
    if status in [JobStatus.COMPLETED, JobStatus.FAILED, JobStatus.DEAD_LETTER]:
        break
    await asyncio.sleep(1)

# Get result
result = await job_service.get_job_result(job_id)
if result:
    print(f&quot;Result: {result.result}&quot;)
    print(f&quot;Duration: {result.duration}s&quot;)
</code></pre>
<h2 id="advanced-features">Advanced Features</h2>
<h3 id="priority-levels">Priority Levels</h3>
<pre><code class="language-python">from researcharr.core.jobs import JobPriority

# Submit with different priorities
critical_job = await job_service.submit_job(
    &quot;urgent_task&quot;,
    priority=JobPriority.CRITICAL,  # 30 - highest
)

high_job = await job_service.submit_job(
    &quot;important_task&quot;,
    priority=JobPriority.HIGH,  # 20
)

normal_job = await job_service.submit_job(
    &quot;regular_task&quot;,
    priority=JobPriority.NORMAL,  # 10 - default
)

low_job = await job_service.submit_job(
    &quot;background_task&quot;,
    priority=JobPriority.LOW,  # 0 - lowest
)
</code></pre>
<h3 id="retry-configuration">Retry Configuration</h3>
<pre><code class="language-python">job_id = await job_service.submit_job(
    &quot;flaky_task&quot;,
    max_retries=5,  # Try up to 5 times
    retry_delay=2.0,  # Start with 2 second delay
    retry_backoff=2.0,  # Double delay each retry
    # Delays: 2s, 4s, 8s, 16s, 32s (capped at 300s)
)
</code></pre>
<h3 id="progress-tracking">Progress Tracking</h3>
<pre><code class="language-python">async def long_running_task(job: JobDefinition, progress_callback):
    &quot;&quot;&quot;Task with progress updates.&quot;&quot;&quot;
    items = job.args[0]

    for i, item in enumerate(items):
        # Process item
        await process_item(item)

        # Update progress
        await progress_callback(
            current=i + 1,
            total=len(items),
            message=f&quot;Processed {i + 1}/{len(items)} items&quot;,
        )

    return {&quot;processed&quot;: len(items)}

# Listen for progress events (if event bus configured)
# Events: job.started, job.progress, job.completed, job.failed
</code></pre>
<h3 id="dead-letter-queue">Dead Letter Queue</h3>
<pre><code class="language-python"># Get failed jobs
dead_letters = await job_service.get_dead_letters(limit=100)

for job in dead_letters:
    print(f&quot;Failed job: {job.id} - {job.handler}&quot;)

# Retry a failed job
job_id = dead_letters[0].id
requeued = await job_service.retry_dead_letter(job_id)
if requeued:
    print(f&quot;Job {job_id} requeued&quot;)
</code></pre>
<h3 id="worker-management">Worker Management</h3>
<pre><code class="language-python"># Get worker info
workers = await job_service.get_workers()
for worker in workers:
    print(f&quot;Worker {worker.id}: {worker.status}&quot;)
    print(f&quot;  Completed: {worker.jobs_completed}&quot;)
    print(f&quot;  Failed: {worker.jobs_failed}&quot;)
    print(f&quot;  Uptime: {worker.uptime}s&quot;)

# Scale workers
await job_service.scale_workers(8)  # Scale to 8 workers

# Stop workers gracefully
await job_service.stop_workers(graceful=True)
</code></pre>
<h3 id="metrics">Metrics</h3>
<pre><code class="language-python">metrics = await job_service.get_metrics()

print(&quot;Queue Metrics:&quot;)
print(f&quot;  Pending: {metrics['queue']['pending']}&quot;)
print(f&quot;  Running: {metrics['queue']['running']}&quot;)
print(f&quot;  Completed: {metrics['queue']['completed']}&quot;)
print(f&quot;  Dead Letter: {metrics['queue']['dead_letter']}&quot;)

print(&quot;Worker Metrics:&quot;)
print(f&quot;  Total: {metrics['workers']['total']}&quot;)
print(f&quot;  Idle: {metrics['workers']['idle']}&quot;)
print(f&quot;  Busy: {metrics['workers']['busy']}&quot;)
print(f&quot;  Healthy: {metrics['workers']['healthy']}&quot;)
</code></pre>
<h2 id="configuration">Configuration</h2>
<h3 id="environment-variables">Environment Variables</h3>
<pre><code class="language-bash"># Redis URL
export REDIS_URL=&quot;redis://localhost:6379/0&quot;

# Worker count (default: CPU count)
export JOB_WORKER_COUNT=4
</code></pre>
<h3 id="programmatic-configuration">Programmatic Configuration</h3>
<pre><code class="language-python">from researcharr.core.jobs import JobService
from researcharr.core.jobs.redis_queue import RedisJobQueue
from researcharr.core.jobs.async_worker import AsyncWorkerPool

# Custom queue configuration
queue = RedisJobQueue(
    redis_url=&quot;redis://localhost:6379/0&quot;,
    key_prefix=&quot;myapp:jobs:&quot;,
    max_dead_letters=5000,
)

# Custom worker pool
workers = AsyncWorkerPool(queue=queue)

# Create service with custom components
service = JobService(
    queue=queue,
    worker_pool=workers,
    event_bus=my_event_bus,  # Optional
)
</code></pre>
<h2 id="integration-with-existing-code">Integration with Existing Code</h2>
<h3 id="wrapping-existing-functions">Wrapping Existing Functions</h3>
<pre><code class="language-python"># Existing sync function
def process_backup(backup_id):
    # ... existing code ...
    return result

# Async wrapper for job handler
async def process_backup_job(job: JobDefinition, progress_callback):
    backup_id = job.args[0]

    # Run sync code in thread pool if needed
    result = await asyncio.to_thread(process_backup, backup_id)

    return result

job_service.register_handler(&quot;process_backup&quot;, process_backup_job)
</code></pre>
<h3 id="integration-with-apscheduler">Integration with APScheduler</h3>
<pre><code class="language-python">from apscheduler.schedulers.asyncio import AsyncIOScheduler

scheduler = AsyncIOScheduler()

# Schedule job submissions
async def submit_daily_backup():
    await job_service.submit_job(
        &quot;process_backup&quot;,
        args=(datetime.now().date(),),
        priority=JobPriority.NORMAL,
    )

scheduler.add_job(
    submit_daily_backup,
    trigger=&quot;cron&quot;,
    hour=2,
    minute=0,
)

scheduler.start()
</code></pre>
<h2 id="best-practices">Best Practices</h2>
<ol>
<li><strong>Handler Design</strong></li>
<li>Keep handlers async</li>
<li>Use progress callbacks for long tasks</li>
<li>Return serializable results (JSON-compatible)</li>
<li>
<p>Handle errors gracefully</p>
</li>
<li>
<p><strong>Resource Management</strong></p>
</li>
<li>Start appropriate number of workers for workload</li>
<li>Monitor worker health regularly</li>
<li>
<p>Scale workers based on queue depth</p>
</li>
<li>
<p><strong>Error Handling</strong></p>
</li>
<li>Set appropriate max_retries for task types</li>
<li>Monitor dead letter queue</li>
<li>
<p>Implement alerting for critical failures</p>
</li>
<li>
<p><strong>Performance</strong></p>
</li>
<li>Use priorities to ensure critical tasks run first</li>
<li>Batch similar jobs when possible</li>
<li>Monitor Redis memory usage</li>
<li>
<p>Use timeouts to prevent stuck jobs</p>
</li>
<li>
<p><strong>Monitoring</strong></p>
</li>
<li>Check metrics regularly</li>
<li>Set up alerts for dead letter queue growth</li>
<li>Monitor worker health</li>
<li>Track job throughput and latency</li>
</ol>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="jobs-not-processing">Jobs Not Processing</h3>
<pre><code class="language-python"># Check workers are running
workers = await job_service.get_workers()
print(f&quot;Active workers: {len(workers)}&quot;)

# Check queue has jobs
metrics = await job_service.get_metrics()
print(f&quot;Pending jobs: {metrics['queue']['pending']}&quot;)

# Check handler is registered
print(f&quot;Registered handlers: {job_service._workers.handlers.keys()}&quot;)
</code></pre>
<h3 id="jobs-failing-repeatedly">Jobs Failing Repeatedly</h3>
<pre><code class="language-python"># Check dead letter queue
dead_letters = await job_service.get_dead_letters()
for job in dead_letters:
    # Get error from Redis
    error = await job_service._queue._redis.hget(
        job_service._queue._key(&quot;error&quot;),
        str(job.id)
    )
    print(f&quot;Job {job.id} error: {error}&quot;)
</code></pre>
<h3 id="redis-connection-issues">Redis Connection Issues</h3>
<pre><code class="language-python"># Test Redis connection
import redis.asyncio as redis

try:
    r = redis.from_url(&quot;redis://localhost:6379/0&quot;)
    await r.ping()
    print(&quot;Redis connected&quot;)
except Exception as e:
    print(f&quot;Redis error: {e}&quot;)
</code></pre>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li><a href="../docs/architecture/JOB_QUEUE_DESIGN.md">Architecture Documentation</a></li>
<li><a href="../docs/api/jobs.md">API Reference</a> (TODO)</li>
<li><a href="../docs/database/jobs.md">Database Schema</a> (TODO)</li>
<li><a href="../docs/monitoring/jobs.md">Metrics Documentation</a> (TODO)</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../Integrations/" class="btn btn-neutral float-left" title="Integrations"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../Logs/" class="btn btn-neutral float-right" title="Logs and Live Streaming">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../Integrations/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../Logs/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
