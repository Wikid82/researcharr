<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="researcharr contributors" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Experimental Tooling: Sourcery & Vulture - researcharr</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/css/researcharr.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Experimental Tooling: Sourcery \u0026 Vulture";
        var mkdocs_page_input_path = "tooling-experiments.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> researcharr
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">researcharr documentation — Day One</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../API/">ResearchArr API (v1)</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Backup-and-Recovery/">Backup and Recovery Procedures</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CI-and-Development/">CI and Development</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CLI-Usage/">CLI Usage Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CONFIGURATION/">Configuration Reference</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Changelog/">Changelog</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Contributing/">Contributing to researcharr</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Coverage-CI-Local-Differences/">Coverage Differences: CI vs Local</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Coverage-Gutters-Example-Comparison/">Coverage Gutters Example Structure</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Coverage-Gutters-Quick-Reference/">Coverage Gutters - Quick Reference Card</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Coverage-Gutters-Quick-Start/">Coverage Gutters - Visual Quick Start Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Coverage-Gutters-Setup/">Coverage Gutters Setup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../DEV/">DEV</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Deployment-and-Resources/">Deployment and Resource Recommendations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Environment-Variables/">Environment variables</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../FAQ/">FAQ</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Getting-Started/">Getting Started</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Health-and-Metrics/">Health and Metrics Endpoints</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Integrations/">Integrations</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Logs/">Logs and Live Streaming</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Packaging-and-Distribution/">Packaging and Distribution</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Plugins/">Plugins and instance configuration</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Recent-Changes/">Recent Changes</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Renovate-Configuration/">Renovate Bot Configuration Guide</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Roadmap/">Roadmap</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../SERVICES_ARCHITECTURE/">Services Architecture</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Status-and-Warnings/">System status warnings and how to fix them</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Versioning/">Versioning & Releases</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../WHEELHOUSE/">Wheelhouse (built wheels) workflow</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Experimental Tooling: Sourcery & Vulture</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#sourcery-in-pre-commit-highmedium-rule-tiers">Sourcery in pre-commit (high/medium rule tiers)</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#1-one-time-setup">1. One-time setup</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#2-running-the-trial-tasks">2. Running the trial tasks</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#sourcery-analyze-trial">Sourcery: Analyze (Trial)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#vulture-dead-code-scan-trial">Vulture: Dead Code Scan (Trial)</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#3-reviewing-results">3. Reviewing results</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#4-cleanup-optional">4. Cleanup (optional)</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#5-capturing-priority-rule-json">5. Capturing priority-rule JSON</a>
    </li>
    </ul>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">researcharr</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">Experimental Tooling: Sourcery & Vulture</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="experimental-tooling-sourcery-vulture">Experimental Tooling: Sourcery &amp; Vulture</h1>
<p>Sourcery now runs automatically as part of <code>pre-commit</code> (limited to the highest-signal rules listed below) while Vulture remains opt-in. Use this doc when you need the full ad-hoc scans, want to tweak the rule tiers, or simply forget the setup steps.</p>
<h2 id="sourcery-in-pre-commit-highmedium-rule-tiers">Sourcery in pre-commit (high/medium rule tiers)</h2>
<p>The <code>sourcery</code> hook in <code>.pre-commit-config.yaml</code> executes <code>sourcery review --check researcharr</code> with a hand-curated rule allowlist. Those rules are grouped into the same "high" and "medium" buckets that power <code>reports/sourcery-priority.json</code>:</p>
<p><strong>High priority (correctness &amp; safety)</strong>
- <code>raise-specific-error</code>
- <code>raise-from-previous-error</code>
- <code>remove-redundant-exception</code>
- <code>simplify-single-exception-tuple</code>
- <code>remove-none-from-default-get</code>
- <code>remove-redundant-path-exists</code></p>
<p><strong>Medium priority (readability &amp; maintainability)</strong>
- <code>collection-into-set</code>
- <code>dict-assign-update-to-union</code>
- <code>hoist-statement-from-if</code>
- <code>introduce-default-else</code>
- <code>merge-list-appends-into-extend</code>
- <code>merge-nested-ifs</code>
- <code>remove-unnecessary-else</code>
- <code>swap-if-else-branches</code></p>
<p>If you want to tighten or relax what runs before each commit, edit the <code>--enable &lt;rule-id&gt;</code> entries in the hook and update this section (and the JSON report, if you keep it synchronized). The hook installs Sourcery automatically, but you still need to provide credentials once per machine—either run <code>sourcery login</code> or export <code>SOURCERY_TOKEN</code> so that both <code>pre-commit</code> and the manual tasks can authenticate.</p>
<h2 id="1-one-time-setup">1. One-time setup</h2>
<pre><code class="language-bash">source .venv/bin/activate
python -m pip install --upgrade &quot;sourcery-cli&gt;=1.16&quot; vulture
</code></pre>
<p>These commands are still useful when you want to run the full Sourcery/Vulture scans manually (outside of the limited pre-commit tier). Sourcery also needs an API token:</p>
<ol>
<li>Create/sign in to a Sourcery account.</li>
<li>Run <code>sourcery login</code> once or export an existing token:
   <code>bash
   export SOURCERY_TOKEN="&lt;paste token&gt;"</code>
   The VS Code task automatically forwards <code>SOURCERY_TOKEN</code> if it is set in your shell/OS.</li>
</ol>
<p>Troubleshooting:</p>
<ul>
<li>If the task output says <code>sourcery: command not found</code> or <code>vulture: command not found</code>, re-run the commands above to make sure both CLIs are installed inside <code>.venv</code>, then verify with:
   <code>bash
   source .venv/bin/activate
   which sourcery
   which vulture</code>
   Both should resolve to paths under <code>.venv/bin</code>.</li>
<li>Sourcery needs to be authenticated once per machine (<code>sourcery login</code>). If it prompts for a token mid-run, finish the login flow and re-run the task.</li>
<li>Vulture exits with code <code>3</code> when it finds issues. That’s expected—inspect the report and decide whether to act on the findings; the non-zero exit code only matters if you script against it.</li>
</ul>
<h2 id="2-running-the-trial-tasks">2. Running the trial tasks</h2>
<p>Open the command palette → <code>Tasks: Run Task</code> and pick:</p>
<h3 id="sourcery-analyze-trial"><code>Sourcery: Analyze (Trial)</code></h3>
<ul>
<li>Prompts for a path (default <code>researcharr</code>).</li>
<li>Executes <code>sourcery review &lt;path&gt;</code> inside the virtualenv.</li>
<li>Output shows suggested refactors/diffs; none are applied automatically.</li>
</ul>
<h3 id="vulture-dead-code-scan-trial"><code>Vulture: Dead Code Scan (Trial)</code></h3>
<ul>
<li>Scans <code>researcharr/</code> and <code>scripts/</code> by default.</li>
<li>Prompts for extra CLI arguments (default <code>--min-confidence 80</code>).</li>
<li>Use flags like <code>--exclude</code> or <code>--sort-by-size</code> to refine results.</li>
</ul>
<h2 id="3-reviewing-results">3. Reviewing results</h2>
<ul>
<li>Treat both reports as advisory. Anything actionable can be turned into a normal issue/PR.</li>
<li>Because these runs are local-only, you can tweak thresholds or scopes without affecting other developers.</li>
<li>Sourcery already blocks on the curated rule set via pre-commit, but these wider runs tell you whether we should promote additional rules (or drop noisy ones) in the future.</li>
</ul>
<h2 id="4-cleanup-optional">4. Cleanup (optional)</h2>
<p>To remove the tools after experimenting:</p>
<pre><code class="language-bash">source .venv/bin/activate
python -m pip uninstall sourcery-cli vulture
</code></pre>
<p>No repository files or workflows depend on them, so uninstalling is safe.</p>
<h2 id="5-capturing-priority-rule-json">5. Capturing priority-rule JSON</h2>
<p>To review only the high-value Sourcery rules discussed earlier:</p>
<pre><code class="language-bash">cd /home/jeremy/Server/Projects/researcharr
source .venv/bin/activate
sourcery review researcharr --csv --no-summary &gt; sourcery-report.csv
python scripts/filter_sourcery_priority.py  # or run the inline snippet below
</code></pre>
<p>Inline snippet (used most recently) that writes <code>reports/sourcery-priority.json</code>:</p>
<pre><code class="language-bash">python - &lt;&lt;'PY'
import csv, json
from pathlib import Path

priority_rules = {
   &quot;raise-specific-error&quot;,
   &quot;raise-from-previous-error&quot;,
   &quot;remove-redundant-exception&quot;,
   &quot;simplify-single-exception-tuple&quot;,
   &quot;remove-redundant-path-exists&quot;,
   &quot;remove-none-from-default-get&quot;,
   &quot;remove-unnecessary-else&quot;,
   &quot;swap-if-else-branches&quot;,
   &quot;merge-nested-ifs&quot;,
   &quot;hoist-statement-from-if&quot;,
   &quot;collection-into-set&quot;,
   &quot;dict-assign-update-to-union&quot;,
   &quot;merge-list-appends-into-extend&quot;,
   &quot;introduce-default-else&quot;,
}

rows = []
with open(&quot;sourcery-report.csv&quot;, newline=&quot;&quot;, encoding=&quot;utf-8&quot;) as fh:
   for row in csv.DictReader(fh):
      if row[&quot;rule&quot;] in priority_rules:
         rows.append(row)

Path(&quot;reports&quot;).mkdir(exist_ok=True)
with open(&quot;reports/sourcery-priority.json&quot;, &quot;w&quot;, encoding=&quot;utf-8&quot;) as fh:
   json.dump({&quot;priority_rules&quot;: sorted(priority_rules), &quot;findings&quot;: rows, &quot;total_findings&quot;: len(rows)}, fh, indent=2)
PY
</code></pre>
<p>The generated JSON currently lists 24 findings under <code>reports/sourcery-priority.json</code>. Re-run the steps above after new Sourcery scans (or after changing the pre-commit allowlist) to refresh the file.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../WHEELHOUSE/" class="btn btn-neutral float-left" title="Wheelhouse (built wheels) workflow"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../WHEELHOUSE/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
